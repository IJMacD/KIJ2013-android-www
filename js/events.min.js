KIJ2013.Events=function(){var e="events.json",h="events",g=function(){KIJ2013.sql("CREATE TABLE IF NOT EXISTS `"+h+"` (`guid` varchar(255) PRIMARY KEY,`title` varchar(255),`date` int,`category` varchar(255),`remind` bool,`description` text)")},c=function(){$.get(e,function(i){KIJ2013.db.transaction(function(j){$(i).each(function(k,l){j.executeSql("INSERT INTO `"+h+"` (`guid`,`title`,`date`,`category`,`remind`,`description`) VALUES (?, ?, ?, ?, ?, ?)",[l.guid,l.title,l.date,l.category,l.remind?1:0,l.description])})});a()},"json").error(function(k,i,j){KIJ2013.showError("Error Fetching Events: "+i)})},f=function(){b($(this).data("guid"))},d=function(k){var i=k.data.guid,j="selected",l=$(this).toggleClass(j).hasClass(j);KIJ2013.sql("UPDATE "+h+" SET `remind` = ? WHERE `guid` = ?",[l?1:0,i]);return false},a=function(){KIJ2013.setActionBarUp("index.html");KIJ2013.setActionBarTitle("Events");var i=KIJ2013.getPreference("subcamp");KIJ2013.sql("SELECT guid,title,date,category,remind FROM `"+h+'` WHERE `date` > ? AND (`category` = ? OR `category` = "all") ORDER BY `date` ASC LIMIT 30',[(new Date())/1000,i],function(n,x){var o=x.rows.length,q=$("<ul/>").attr("id","event-list").addClass("listview"),p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=0;if(o){for(;m<o;m++){var w=x.rows.item(m),r=w.guid,s=$("<li/>"),v=$("<a/>").attr("id",r),k=new Date(w.date*1000),l=$("<p/>").addClass("date-text").text(k.getDate()+" "+p[k.getMonth()]),t=$("<p/>").addClass("title").text(w.title),u=$("<a/>").addClass("remind-btn button").addClass(w.remind?"selected":"").text("Remind").click({guid:r},d),j=$("<p/>").addClass("category").text(w.category);v.data("guid",w.guid);v.click(f);v.append(l).append(t).append(u).append(j);s.append(v);q.append(s)}$("#body").empty().append(q)}else{KIJ2013.showLoading()}})},b=function(i){KIJ2013.setActionBarUp(a);var j=KIJ2013.getPreference("subcamp");KIJ2013.sql("SELECT title,date,remind,category,description FROM `"+h+'` WHERE guid = ? AND (`category` = ? OR `category` = "all") LIMIT 1',[i,j],function(l,k){if(k.rows.length==1){var o=k.rows.item(0),n=$("<div/>").css({padding:"10px"}),m=new Date(o.date*1000);KIJ2013.setActionBarTitle(o.title);$("#body").empty();$("<h1/>").text(o.title).appendTo(n);$("<p/>").addClass("date-text").text(m.toLocaleString()).appendTo(n);$("<a/>").addClass("button").addClass(o.remind?"selected":"").text("Remind").click({guid:i},d).appendTo(n);$("<p/>").attr("id","remind-text").text(o.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(n);$("<p/>").addClass("category").text(o.category).appendTo(n);$("<p/>").text(o.description).appendTo(n);$("#body").append(n);window.scrollTo(0,1)}})};return{init:function(){KIJ2013.init(function(){a()});g();c();setTimeout(function(){window.scrollTo(0,1)},1)}}}();$(KIJ2013.Events.init);